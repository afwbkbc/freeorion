os: Visual Studio 2015

version: ci-{build}

environment:
  matrix:
    - BUILD_SYSTEM: CMAKE

init:
  - git config --global core.eol native
  - git config --global core.autocrlf true

clone_depth: 50

install:
  # Remove the VS Xamarin targets to reduce AppVeyor specific noise in build
  # logs.  See also http://help.appveyor.com/discussions/problems/4569
  - del "C:\Program Files (x86)\MSBuild\14.0\Microsoft.Common.targets\ImportAfter\Xamarin.Common.targets"
  - cd ..
  - ps: Start-FileDownload https://github.com/freeorion/freeorion-sdk/releases/download/v5/FreeOrionSDK_5_MSVC-v140-xp.zip -FileName FreeOrionSDK.zip
  - unzip -q FreeOrionSDK.zip
  - cp bin/* freeorion/
  - cd freeorion

before_build:
  - if "%BUILD_SYSTEM%" == "MSVC" (
      cd msvc2015
    )
  - if "%BUILD_SYSTEM%" == "CMAKE" (
      mkdir build
    )

build_script:
  - if "%BUILD_SYSTEM%" == "MSVC" (
      msbuild FreeOrion.sln /property:Configuration=Release-XP /logger:"C:\Program Files\AppVeyor\BuildAgent\Appveyor.MSBuildLogger.dll" /verbosity:minimal
    )
  - if "%BUILD_SYSTEM%" == "CMAKE" (
      pushd build &&
      cmake -DCMAKE_CXX_FLAGS=/MP -G "Visual Studio 14 2015" .. &&
      popd
    )

after_build:
  - if "%BUILD_SYSTEM%" == "CMAKE" (
      7z a msvcproj.zip build\*.sln build\*.vcxproj build\*.filter build\GG\*.vcxproj build\GG\*.filter
    )

test: off

artifacts:
  - name: FreeOrionMSVCProject
    path: msvcproj.zip
